<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Fireworks ‚Äì Starry Sky</title>
  <style>
    :root {
      --bg-color: #0b1120;
    }

    * {
      margin: 0;
      box-sizing: border-box
    }

    body {
      background: var(--bg-color);
      overflow: hidden;
      font-family: Arial, Helvetica, sans-serif;
    }

    canvas {
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      display: block;
      cursor: crosshair
    }

    h2 {
      position: fixed;
      top: 1rem;
      left: 50%;
      transform: translateX(-50%);
      color: #e2e8f0;
      pointer-events: none;
      text-shadow: 0 0 4px #000;
      font-size: 3rem;
    }
  </style>
</head>

<body>
  <canvas id="bg"></canvas>
  <h2>Click / Tap ‚ú®</h2>

  <!-- 1Ô∏è‚É£  Star‚Äëfield particles (runs its own requestAnimationFrame) -->
  <script src="../bg.js"></script>

  <!-- 2Ô∏è‚É£  Fireworks share the same canvas and reset state every frame so starfield stays alive -->
  <script>
    const cvs = document.getElementById('bg');
    const ctx = cvs.getContext('2d', { alpha: true });

    let W = innerWidth, H = innerHeight;
    const resize = () => { W = cvs.width = innerWidth; H = cvs.height = innerHeight; };
    addEventListener('resize', resize); resize();

    /* ------------------ Firework particle ------------------ */
    class Particle {
      constructor(x, y, col) {
        this.x = x; this.y = y;
        const a = Math.random() * Math.PI * 2, s = Math.random() * 4 + 1.4;
        this.vx = Math.cos(a) * s;
        this.vy = Math.sin(a) * s;
        this.alpha = 1;
        this.col = col;
        this.size = Math.random() * 3 + 1;
      }
      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vy += 0.02;          // gravity
        this.alpha -= 0.012;
      }
      draw() {
        ctx.globalAlpha = this.alpha;
        ctx.fillStyle = this.col;
        ctx.fillRect(this.x, this.y, this.size, this.size);
      }
    }

    const fireworks = [];
    const palette = ['#f472b6', '#38bdf8', '#fbbf24', '#a78bfa', '#4ade80'];

    function boom(x, y) {
      const col = palette[Math.random() * palette.length | 0];
      for (let i = 0; i < 60; i++) fireworks.push(new Particle(x, y, col));
    }
    addEventListener('pointerdown', e => boom(e.clientX, e.clientY));

    /* ------------------ Main loop ------------------ */
    function loop() {
      // üîÑ  Always restore the canvas state at the **start** of the frame so bg.js keeps drawing
      ctx.globalCompositeOperation = 'source-over';
      ctx.globalAlpha = 1;   // ‚≠êÔ∏è IMPORTANT: make sure starfield draws at full opacity

      // Fireworks on top, in additive mode
      ctx.globalCompositeOperation = 'lighter';
      for (let i = fireworks.length; i--;) {
        const p = fireworks[i];
        p.update(); p.draw();
        if (p.alpha <= 0) fireworks.splice(i, 1);
      }

      // Reset for anyone else who draws later (not strictly needed but good hygiene)
      ctx.globalCompositeOperation = 'source-over';
      ctx.globalAlpha = 1;
      requestAnimationFrame(loop);
    }
    loop();
  </script>
</body>

</html>